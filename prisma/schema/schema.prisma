// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model Feedback {
  id      String  @id @default(nanoid(11))
  review  Int
  message String
  email   String?
  userId  String?
  user    User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Task {
  id                String       @id @default(nanoid(11))
  userId            String
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  title             String
  description       String?
  priority          Priority     @default(optional)
  difficulty        Int          @default(3) // 1-5
  estimatedDuration Int          // minutes
  status            TaskStatus   @default(inbox)
  kanbanColumn      KanbanColumn @default(inbox)

  deadline          DateTime?
  quarter           String?      // "Q1-2026", "Q2-2026", etc.

  parentTaskId      String?
  parentTask        Task?        @relation("TaskSubtasks", fields: [parentTaskId], references: [id], onDelete: Cascade)
  subtasks          Task[]       @relation("TaskSubtasks")

  dependencies      String[]     // Array of task IDs

  weekSkippedCount  Int          @default(0)

  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  completedAt       DateTime?
  deletedAt         DateTime?    // Soft delete - tasks marked for deletion
  archivedAt        DateTime?    // Auto-archived after 7 days in done

  @@index([userId, status])
  @@index([userId, priority])
  @@index([userId, deletedAt])
  @@index([userId, archivedAt])
  @@map("task")
}

enum Priority {
  sacred
  important
  optional
}

enum TaskStatus {
  inbox
  todo
  doing
  done
}

enum KanbanColumn {
  inbox
  todo
  doing
  done
}
